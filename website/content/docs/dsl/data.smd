---
.title = "#data",
.description = "Embedded data arrays, shape generators, and blobs",
.author = "PNGine Team",
.date = @date("2024-12-30"),
.layout = "docs.shtml",
---

Defines embedded data for buffer initialization. Supports compile-time shape generators, inline arrays, and external files.

## Syntax

```
// Shape generator (compile-time mesh generation)
#data name {
  cube={ format=[position4 color4 uv2] }
}

// Inline float array
#data name {
  float32Array=[1.0 2.0 3.0]
}

// External file
#data name {
  blob={ file={ url="path/to/file.png" } }
  mime="image/png"
}
```

## Attributes

| Attribute | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `cube` | object | * | - | Cube mesh generator |
| `plane` | object | * | - | Plane mesh generator |
| `float32Array` | array/object | * | - | Float array data |
| `blob` | object | * | - | External file reference |
| `mime` | string | No | - | MIME type for blob |

*Exactly one of `cube`, `plane`, `float32Array`, or `blob` required.

## Shape Generators

Generate vertex data at compile time instead of writing arrays manually. Shape generators produce triangle lists with the specified vertex attributes.

### cube

**Type:** `object`

Generates a unit cube centered at origin (vertices at ±1). Produces 36 vertices (6 faces × 2 triangles × 3 vertices).

```
#data cubeVertices {
  cube={ format=[position4 color4 uv2] }
}
```

### plane

**Type:** `object`

Generates a single quad on the XY plane. Produces 6 vertices (2 triangles).

```
#data planeVertices {
  plane={ format=[position3 uv2] }
}
```

### Format Specifiers

The `format=` array specifies which attributes to generate for each vertex:

| Specifier | Type | Size | Description |
|-----------|------|------|-------------|
| `position3` | vec3f | 12 bytes | XYZ position |
| `position4` | vec4f | 16 bytes | XYZW position (w=1) |
| `normal3` | vec3f | 12 bytes | Surface normal |
| `color3` | vec3f | 12 bytes | RGB vertex color |
| `color4` | vec4f | 16 bytes | RGBA vertex color |
| `uv2` | vec2f | 8 bytes | Texture coordinates |

**Vertex stride** is the sum of all attribute sizes. For `[position4 color4 uv2]`:
- position4: 16 bytes
- color4: 16 bytes
- uv2: 8 bytes
- **Total stride: 40 bytes**

### float32Array

**Type:** `array` or `object`

#### Inline Array

Direct float values:

```
#data vertices {
  float32Array=[
    0.0  0.5  1.0 0.0 0.0
   -0.5 -0.5  0.0 1.0 0.0
    0.5 -0.5  0.0 0.0 1.0
  ]
}
```

#### Generated Array

Computed values using expressions:

```
#data particles {
  float32Array={
    numberOfElements=2048
    initEachElementWith=[
      "cos((ELEMENT_ID / 2048) * PI * 2)"
      "sin((ELEMENT_ID / 2048) * PI * 2)"
      "random() * 0.1"
      "random() * 0.1"
    ]
  }
}
```

**numberOfElements:** Number of elements to generate.

**initEachElementWith:** Array of expressions. Each expression is evaluated for each element, producing one float per expression per element.

Available variables in expressions:

| Variable | Description |
|----------|-------------|
| `ELEMENT_ID` | Current element index (0 to N-1) |
| `PI` | 3.14159... |
| `E` | 2.71828... |
| `TAU` | 2 * PI |
| `random()` | Random value 0-1 |

### blob

**Type:** `object`

Reference to external file:

```
#data imageFile {
  blob={ file={ url="textures/diffuse.png" } }
  mime="image/png"
}
```

The file is embedded in the bytecode at compile time.

## Examples

### Cube with Shape Generator

```
#define CUBE_VERTEX_SIZE=40
#define CUBE_VERTEX_COUNT=36

#data cubeVertices {
  cube={ format=[position4 color4 uv2] }
}

#buffer vertexBuffer {
  size=cubeVertices
  usage=[VERTEX]
  mappedAtCreation=cubeVertices
}

#renderPipeline cubeRenderer {
  layout=auto
  vertex={
    module=shader
    entryPoint=vs
    buffers=[{
      arrayStride=CUBE_VERTEX_SIZE
      attributes=[
        { shaderLocation=0 offset=0 format=float32x4 }
        { shaderLocation=1 offset=16 format=float32x4 }
        { shaderLocation=2 offset=32 format=float32x2 }
      ]
    }]
  }
  fragment={ module=shader entryPoint=fs targets=[{ format=preferredCanvasFormat }] }
}
```

### Simple Triangle (Manual Data)

```
#data triangleVerts {
  float32Array=[
    0.0  0.5  1 0 0
   -0.5 -0.5  0 1 0
    0.5 -0.5  0 0 1
  ]
}

#buffer vertexBuffer {
  size=triangleVerts
  usage=[VERTEX]
  mappedAtCreation=triangleVerts
}
```

### External Image

```
#data textureData {
  blob={ file={ url="assets/logo.png" } }
  mime="image/png"
}

#imageBitmap logo {
  image=textureData
}
```

### Procedural Particle Init

```
#define NUM_PARTICLES=4096

#data initialParticles {
  float32Array={
    numberOfElements=NUM_PARTICLES
    initEachElementWith=[
      "cos((ELEMENT_ID / NUM_PARTICLES) * TAU)"
      "sin((ELEMENT_ID / NUM_PARTICLES) * TAU)"
      "(random() - 0.5) * 0.02"
      "(random() - 0.5) * 0.02"
    ]
  }
}
```

## Data Size

When referencing `#data` in buffer size:

```
#buffer verts {
  size=vertexData  // Uses byte size of data
  usage=[VERTEX]
  mappedAtCreation=vertexData
}
```

Size calculation:
- **Shape generators**: vertex_count × stride (e.g., cube with position4+color4+uv2 = 36 × 40 = 1440 bytes)
- **Inline arrays**: element_count × 4 bytes
- **Generated arrays**: numberOfElements × expressions_count × 4 bytes

## Validation Rules

| Rule | Error |
|------|-------|
| Name must be unique | `duplicate_definition` |
| Exactly one data source required | `missing_required_property` |
| Format specifiers must be valid | `invalid_format` |

## Related

- [`#buffer`](/docs/dsl/buffer/) - Use data for buffer initialization
- [`#imageBitmap`](/docs/dsl/image-bitmap/) - Create images from blob data
- [`#queue`](/docs/dsl/queue/) - Write data to buffers at runtime
