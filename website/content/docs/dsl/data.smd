---
.title = "#data",
.description = "Embedded data arrays, blobs, and WASM-generated data",
.author = "PNGine Team",
.date = @date("2024-12-21"),
.layout = "docs.shtml",
---

Defines embedded data for buffer initialization, texture loading, or procedural generation.

## Syntax

```zig
#data name {
  float32Array=[1.0 2.0 3.0]
}

#data name {
  float32Array={
    numberOfElements=1024
    initEachElementWith=["expression"]
  }
}

#data name {
  blob={ file={ url="path/to/file.png" } }
  mime="image/png"
}

#data name {
  wasm={
    module={ url="path/to/module.wasm" }
    func="functionName"
    returns="vec4f"
  }
}
```

## Attributes

| Attribute | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `float32Array` | array/object | * | - | Float array data |
| `blob` | object | * | - | External file reference |
| `wasm` | object | * | - | WASM-generated data |
| `mime` | string | No | - | MIME type for blob |

*Exactly one of `float32Array`, `blob`, or `wasm` required.

### float32Array

**Type:** `array` or `object`

#### Inline Array

Direct float values:

```zig
#data vertices {
  float32Array=[
    0.0  0.5  1.0 0.0 0.0
   -0.5 -0.5  0.0 1.0 0.0
    0.5 -0.5  0.0 0.0 1.0
  ]
}
```

#### Generated Array

Computed values using expressions:

```zig
#data particles {
  float32Array={
    numberOfElements=2048
    initEachElementWith=[
      "cos((ELEMENT_ID / 2048) * PI * 2)"
      "sin((ELEMENT_ID / 2048) * PI * 2)"
      "random() * 0.1"
      "random() * 0.1"
    ]
  }
}
```

**numberOfElements:** Number of elements to generate.

**initEachElementWith:** Array of expressions. Each expression is evaluated for each element, producing one float per expression per element.

Available variables in expressions:

| Variable | Description |
|----------|-------------|
| `ELEMENT_ID` | Current element index (0 to N-1) |
| `PI` | 3.14159... |
| `E` | 2.71828... |
| `TAU` | 2 * PI |
| `random()` | Random value 0-1 |

### blob

**Type:** `object`

Reference to external file:

```zig
#data imageFile {
  blob={ file={ url="textures/diffuse.png" } }
  mime="image/png"
}
```

The file is embedded in the bytecode at compile time.

### wasm

**Type:** `object`

Data generated by a WASM module function:

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `module` | object | Yes | WASM module reference |
| `func` | string | Yes | Function name to call |
| `returns` | string | No | Return type |
| `args` | array | No | Function arguments |

```zig
#data mvpMatrix {
  wasm={
    module={ url="math.wasm" }
    func="computeMVP"
    returns="mat4x4f"
  }
}
```

Return types: `f32`, `vec2f`, `vec3f`, `vec4f`, `mat4x4f`

## Examples

### Vertex Data

```zig
#data cubeVertices {
  float32Array=[
    // position      // normal       // uv
    -1 -1 -1         0  0 -1         0 0
     1 -1 -1         0  0 -1         1 0
     1  1 -1         0  0 -1         1 1
    -1  1 -1         0  0 -1         0 1
    // ... more vertices
  ]
}

#buffer vertexBuffer {
  size=cubeVertices
  usage=[VERTEX]
  mappedAtCreation=cubeVertices
}
```

### Procedural Particle Init

```zig
#define NUM_PARTICLES=4096

#data initialParticles {
  float32Array={
    numberOfElements=NUM_PARTICLES
    initEachElementWith=[
      "cos((ELEMENT_ID / NUM_PARTICLES) * TAU)"
      "sin((ELEMENT_ID / NUM_PARTICLES) * TAU)"
      "(random() - 0.5) * 0.02"
      "(random() - 0.5) * 0.02"
    ]
  }
}
```

### External Image

```zig
#data textureData {
  blob={ file={ url="assets/logo.png" } }
  mime="image/png"
}

#imageBitmap logo {
  image=textureData
}
```

### Index Data

```zig
#data cubeIndices {
  float32Array=[
    0 1 2  2 3 0
    4 5 6  6 7 4
    // ... more indices
  ]
}
```

Note: For index buffers, use integer values. They're stored as floats but converted at runtime.

### WASM-Generated Data

```zig
#data projectionMatrix {
  wasm={
    module={ url="matrices.wasm" }
    func="perspective"
    returns="mat4x4f"
    args=[1.0472 1.0 0.1 100.0]
  }
}
```

## Data Size

When referencing `#data` in buffer size:

```zig
#buffer verts {
  size=vertexData  // Uses byte size of float32Array
  usage=[VERTEX]
  mappedAtCreation=vertexData
}
```

For inline arrays: `size = element_count * 4` bytes

For generated arrays: `size = numberOfElements * expressions_count * 4` bytes

## Validation Rules

| Rule | Error |
|------|-------|
| Name must be unique across all namespaces | `duplicate_definition` |
| One of `float32Array`, `blob`, or `wasm` required | `missing_required_property` |

## Related

- [`#buffer`](/docs/dsl/buffer/) - Use data for buffer initialization
- [`#imageBitmap`](/docs/dsl/image-bitmap/) - Create images from blob data
- [`#queue`](/docs/dsl/queue/) - Write data to buffers
- [`#wasmCall`](/docs/dsl/wasm-call/) - Call WASM functions
